!function(){"use strict";class e extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.isOpen=!1;const e=document.createElement("style");e.textContent='\n      :host {\n        display: block;\n      }\n\n      .chat-bubble {\n        position: fixed;\n        bottom: 73px;\n        right: 35px;\n        width: 50px;\n        height: 50px;\n        background-color: var(--primary-color, #007BFF);\n        border-radius: 50%;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: transform 0.3s, background-color 0.3s;\n        z-index: 9990;\n      }\n\n      :host([position="bottom-left"]) .chat-bubble {\n        left: 24px;\n        right: auto;\n      }\n\n      .chat-bubble:hover {\n        transform: scale(1.05);\n        background-color: var(--primary-hover, #0069d9);\n      }\n\n      .chat-bubble svg {\n        width: 24px;\n        height: 24px;\n        fill: none;\n        stroke: white;\n        stroke-width: 2;\n        stroke-linecap: round;\n        stroke-linejoin: round;\n        transition: transform 0.3s ease;\n      }\n\n      .chat-bubble.open svg {\n        transform: rotate(180deg);\n      }\n\n      @keyframes pulse {\n        0% {\n          box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);\n        }\n        70% {\n          box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);\n        }\n        100% {\n          box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);\n        }\n      }\n\n      .chat-bubble.pulse {\n        animation: pulse 2s infinite;\n      }\n    ';const t=document.createElement("template");t.innerHTML='\n      <div class="chat-bubble pulse">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n          <path d="M18 15l-6-6-6 6"></path>\n        </svg>\n      </div>\n    ',this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.bubbleElement=this.shadowRoot.querySelector(".chat-bubble")}connectedCallback(){this.bubbleElement.addEventListener("click",(()=>{this.bubbleElement.classList.remove("pulse"),this.isOpen=!this.isOpen,this.isOpen?this.bubbleElement.classList.add("open"):this.bubbleElement.classList.remove("open")}))}attributeChangedCallback(e,t,n){"position"===e&&t!==n&&("bottom-left"===n?(this.bubbleElement.style.left="24px",this.bubbleElement.style.right="auto"):(this.bubbleElement.style.right="24px",this.bubbleElement.style.left="auto"))}static get observedAttributes(){return["position"]}}function t(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}customElements.define("chat-button",e);let n={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function s(e){n=e}const r={exec:()=>null};function o(e,t=""){let n="string"==typeof e?e:e.source;const s={replace:(e,t)=>{let r="string"==typeof t?t:t.source;return r=r.replace(i.caret,"$1"),n=n.replace(e,r),s},getRegex:()=>new RegExp(n,t)};return s}const i={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:e=>new RegExp(`^( {0,3}${e})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}#`),htmlBeginRegex:e=>new RegExp(`^ {0,${Math.min(3,e-1)}}<(?:[a-z].*>|!--)`,"i")},a=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,l=/(?:[*+-]|\d{1,9}[.)])/,c=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,h=o(c).replace(/bull/g,l).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),p=o(c).replace(/bull/g,l).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),d=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,u=/(?!\s*\])(?:\\.|[^\[\]\\])+/,g=o(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",u).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),m=o(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,l).getRegex(),f="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",b=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,x=o("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",b).replace("tag",f).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),k=o(d).replace("hr",a).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",f).getRegex(),w={blockquote:o(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",k).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:g,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:a,html:x,lheading:h,list:m,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:k,table:r,text:/^[^\n]+/},y=o("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",a).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",f).getRegex(),v={...w,lheading:p,table:y,paragraph:o(d).replace("hr",a).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",y).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",f).getRegex()},T={...w,html:o("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",b).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:r,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:o(d).replace("hr",a).replace("heading"," *#{1,6} *[^\n]").replace("lheading",h).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},S=/^( {2,}|\\)\n(?!\s*$)/,E=/[\p{P}\p{S}]/u,_=/[\s\p{P}\p{S}]/u,A=/[^\s\p{P}\p{S}]/u,C=o(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,_).getRegex(),R=/(?!~)[\p{P}\p{S}]/u,I=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,L=o(I,"u").replace(/punct/g,E).getRegex(),z=o(I,"u").replace(/punct/g,R).getRegex(),N="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",$=o(N,"gu").replace(/notPunctSpace/g,A).replace(/punctSpace/g,_).replace(/punct/g,E).getRegex(),M=o(N,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,R).getRegex(),O=o("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,A).replace(/punctSpace/g,_).replace(/punct/g,E).getRegex(),D=o(/\\(punct)/,"gu").replace(/punct/g,E).getRegex(),B=o(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),F=o(b).replace("(?:--\x3e|$)","--\x3e").getRegex(),P=o("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",F).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),H=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,U=o(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",H).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),q=o(/^!?\[(label)\]\[(ref)\]/).replace("label",H).replace("ref",u).getRegex(),j=o(/^!?\[(ref)\](?:\[\])?/).replace("ref",u).getRegex(),W={_backpedal:r,anyPunctuation:D,autolink:B,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:S,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:r,emStrongLDelim:L,emStrongRDelimAst:$,emStrongRDelimUnd:O,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:U,nolink:j,punctuation:C,reflink:q,reflinkSearch:o("reflink|nolink(?!\\()","g").replace("reflink",q).replace("nolink",j).getRegex(),tag:P,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:r},G={...W,link:o(/^!?\[(label)\]\((.*?)\)/).replace("label",H).getRegex(),reflink:o(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",H).getRegex()},Y={...W,emStrongRDelimAst:M,emStrongLDelim:z,url:o(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Z={...Y,br:o(S).replace("{2,}","*").getRegex(),text:o(Y.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},X={normal:w,gfm:v,pedantic:T},Q={normal:W,gfm:Y,breaks:Z,pedantic:G},K={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},J=e=>K[e];function V(e,t){if(t){if(i.escapeTest.test(e))return e.replace(i.escapeReplace,J)}else if(i.escapeTestNoEncode.test(e))return e.replace(i.escapeReplaceNoEncode,J);return e}function ee(e){try{e=encodeURI(e).replace(i.percentDecode,"%")}catch{return null}return e}function te(e,t){const n=e.replace(i.findPipe,((e,t,n)=>{let s=!1,r=t;for(;--r>=0&&"\\"===n[r];)s=!s;return s?"|":" |"})).split(i.splitPipe);let s=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),t)if(n.length>t)n.splice(t);else for(;n.length<t;)n.push("");for(;s<n.length;s++)n[s]=n[s].trim().replace(i.slashPipe,"|");return n}function ne(e,t,n){const s=e.length;if(0===s)return"";let r=0;for(;r<s;){if(e.charAt(s-r-1)!==t)break;r++}return e.slice(0,s-r)}function se(e,t,n,s,r){const o=t.href,i=t.title||null,a=e[1].replace(r.other.outputLinkReplace,"$1");s.state.inLink=!0;const l={type:"!"===e[0].charAt(0)?"image":"link",raw:n,href:o,title:i,text:a,tokens:s.inlineTokens(a)};return s.state.inLink=!1,l}class re{options;rules;lexer;constructor(e){this.options=e||n}space(e){const t=this.rules.block.newline.exec(e);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(e){const t=this.rules.block.code.exec(e);if(t){const e=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?e:ne(e,"\n")}}}fences(e){const t=this.rules.block.fences.exec(e);if(t){const e=t[0],n=function(e,t,n){const s=e.match(n.other.indentCodeCompensation);if(null===s)return t;const r=s[1];return t.split("\n").map((e=>{const t=e.match(n.other.beginningSpace);if(null===t)return e;const[s]=t;return s.length>=r.length?e.slice(r.length):e})).join("\n")}(e,t[3]||"",this.rules);return{type:"code",raw:e,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:n}}}heading(e){const t=this.rules.block.heading.exec(e);if(t){let e=t[2].trim();if(this.rules.other.endingHash.test(e)){const t=ne(e,"#");this.options.pedantic?e=t.trim():t&&!this.rules.other.endingSpaceChar.test(t)||(e=t.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:e,tokens:this.lexer.inline(e)}}}hr(e){const t=this.rules.block.hr.exec(e);if(t)return{type:"hr",raw:ne(t[0],"\n")}}blockquote(e){const t=this.rules.block.blockquote.exec(e);if(t){let e=ne(t[0],"\n").split("\n"),n="",s="";const r=[];for(;e.length>0;){let t=!1;const o=[];let i;for(i=0;i<e.length;i++)if(this.rules.other.blockquoteStart.test(e[i]))o.push(e[i]),t=!0;else{if(t)break;o.push(e[i])}e=e.slice(i);const a=o.join("\n"),l=a.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}\n${a}`:a,s=s?`${s}\n${l}`:l;const c=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(l,r,!0),this.lexer.state.top=c,0===e.length)break;const h=r.at(-1);if("code"===h?.type)break;if("blockquote"===h?.type){const t=h,o=t.raw+"\n"+e.join("\n"),i=this.blockquote(o);r[r.length-1]=i,n=n.substring(0,n.length-t.raw.length)+i.raw,s=s.substring(0,s.length-t.text.length)+i.text;break}if("list"!==h?.type);else{const t=h,o=t.raw+"\n"+e.join("\n"),i=this.list(o);r[r.length-1]=i,n=n.substring(0,n.length-h.raw.length)+i.raw,s=s.substring(0,s.length-t.raw.length)+i.raw,e=o.substring(r.at(-1).raw.length).split("\n")}}return{type:"blockquote",raw:n,tokens:r,text:s}}}list(e){let t=this.rules.block.list.exec(e);if(t){let n=t[1].trim();const s=n.length>1,r={type:"list",raw:"",ordered:s,start:s?+n.slice(0,-1):"",loose:!1,items:[]};n=s?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=s?n:"[*+-]");const o=this.rules.other.listItemRegex(n);let i=!1;for(;e;){let n=!1,s="",a="";if(!(t=o.exec(e)))break;if(this.rules.block.hr.test(e))break;s=t[0],e=e.substring(s.length);let l=t[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,(e=>" ".repeat(3*e.length))),c=e.split("\n",1)[0],h=!l.trim(),p=0;if(this.options.pedantic?(p=2,a=l.trimStart()):h?p=t[1].length+1:(p=t[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,a=l.slice(p),p+=t[1].length),h&&this.rules.other.blankLine.test(c)&&(s+=c+"\n",e=e.substring(c.length+1),n=!0),!n){const t=this.rules.other.nextBulletRegex(p),n=this.rules.other.hrRegex(p),r=this.rules.other.fencesBeginRegex(p),o=this.rules.other.headingBeginRegex(p),i=this.rules.other.htmlBeginRegex(p);for(;e;){const d=e.split("\n",1)[0];let u;if(c=d,this.options.pedantic?(c=c.replace(this.rules.other.listReplaceNesting,"  "),u=c):u=c.replace(this.rules.other.tabCharGlobal,"    "),r.test(c))break;if(o.test(c))break;if(i.test(c))break;if(t.test(c))break;if(n.test(c))break;if(u.search(this.rules.other.nonSpaceChar)>=p||!c.trim())a+="\n"+u.slice(p);else{if(h)break;if(l.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(r.test(l))break;if(o.test(l))break;if(n.test(l))break;a+="\n"+c}h||c.trim()||(h=!0),s+=d+"\n",e=e.substring(d.length+1),l=u.slice(p)}}r.loose||(i?r.loose=!0:this.rules.other.doubleBlankLine.test(s)&&(i=!0));let d,u=null;this.options.gfm&&(u=this.rules.other.listIsTask.exec(a),u&&(d="[ ] "!==u[0],a=a.replace(this.rules.other.listReplaceTask,""))),r.items.push({type:"list_item",raw:s,task:!!u,checked:d,loose:!1,text:a,tokens:[]}),r.raw+=s}const a=r.items.at(-1);if(!a)return;a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd(),r.raw=r.raw.trimEnd();for(let e=0;e<r.items.length;e++)if(this.lexer.state.top=!1,r.items[e].tokens=this.lexer.blockTokens(r.items[e].text,[]),!r.loose){const t=r.items[e].tokens.filter((e=>"space"===e.type)),n=t.length>0&&t.some((e=>this.rules.other.anyLine.test(e.raw)));r.loose=n}if(r.loose)for(let e=0;e<r.items.length;e++)r.items[e].loose=!0;return r}}html(e){const t=this.rules.block.html.exec(e);if(t){return{type:"html",block:!0,raw:t[0],pre:"pre"===t[1]||"script"===t[1]||"style"===t[1],text:t[0]}}}def(e){const t=this.rules.block.def.exec(e);if(t){const e=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:e,raw:t[0],href:n,title:s}}}table(e){const t=this.rules.block.table.exec(e);if(!t)return;if(!this.rules.other.tableDelimiter.test(t[2]))return;const n=te(t[1]),s=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],o={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===s.length){for(const e of s)this.rules.other.tableAlignRight.test(e)?o.align.push("right"):this.rules.other.tableAlignCenter.test(e)?o.align.push("center"):this.rules.other.tableAlignLeft.test(e)?o.align.push("left"):o.align.push(null);for(let e=0;e<n.length;e++)o.header.push({text:n[e],tokens:this.lexer.inline(n[e]),header:!0,align:o.align[e]});for(const e of r)o.rows.push(te(e,o.header.length).map(((e,t)=>({text:e,tokens:this.lexer.inline(e),header:!1,align:o.align[t]}))));return o}}lheading(e){const t=this.rules.block.lheading.exec(e);if(t)return{type:"heading",raw:t[0],depth:"="===t[2].charAt(0)?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(e){const t=this.rules.block.paragraph.exec(e);if(t){const e="\n"===t[1].charAt(t[1].length-1)?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:e,tokens:this.lexer.inline(e)}}}text(e){const t=this.rules.block.text.exec(e);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(e){const t=this.rules.inline.escape.exec(e);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(e){const t=this.rules.inline.tag.exec(e);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(e){const t=this.rules.inline.link.exec(e);if(t){const e=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(e)){if(!this.rules.other.endAngleBracket.test(e))return;const t=ne(e.slice(0,-1),"\\");if((e.length-t.length)%2==0)return}else{const e=function(e,t){if(-1===e.indexOf(t[1]))return-1;let n=0;for(let s=0;s<e.length;s++)if("\\"===e[s])s++;else if(e[s]===t[0])n++;else if(e[s]===t[1]&&(n--,n<0))return s;return n>0?-2:-1}(t[2],"()");if(-2===e)return;if(e>-1){const n=(0===t[0].indexOf("!")?5:4)+t[1].length+e;t[2]=t[2].substring(0,e),t[0]=t[0].substring(0,n).trim(),t[3]=""}}let n=t[2],s="";if(this.options.pedantic){const e=this.rules.other.pedanticHrefTitle.exec(n);e&&(n=e[1],s=e[3])}else s=t[3]?t[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(n=this.options.pedantic&&!this.rules.other.endAngleBracket.test(e)?n.slice(1):n.slice(1,-1)),se(t,{href:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n,title:s?s.replace(this.rules.inline.anyPunctuation,"$1"):s},t[0],this.lexer,this.rules)}}reflink(e,t){let n;if((n=this.rules.inline.reflink.exec(e))||(n=this.rules.inline.nolink.exec(e))){const e=t[(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!e){const e=n[0].charAt(0);return{type:"text",raw:e,text:e}}return se(n,e,n[0],this.lexer,this.rules)}}emStrong(e,t,n=""){let s=this.rules.inline.emStrongLDelim.exec(e);if(!s)return;if(s[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(s[1]||s[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const n=[...s[0]].length-1;let r,o,i=n,a=0;const l="*"===s[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(l.lastIndex=0,t=t.slice(-1*e.length+n);null!=(s=l.exec(t));){if(r=s[1]||s[2]||s[3]||s[4]||s[5]||s[6],!r)continue;if(o=[...r].length,s[3]||s[4]){i+=o;continue}if((s[5]||s[6])&&n%3&&!((n+o)%3)){a+=o;continue}if(i-=o,i>0)continue;o=Math.min(o,o+i+a);const t=[...s[0]][0].length,l=e.slice(0,n+s.index+t+o);if(Math.min(n,o)%2){const e=l.slice(1,-1);return{type:"em",raw:l,text:e,tokens:this.lexer.inlineTokens(e)}}const c=l.slice(2,-2);return{type:"strong",raw:l,text:c,tokens:this.lexer.inlineTokens(c)}}}}codespan(e){const t=this.rules.inline.code.exec(e);if(t){let e=t[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(e),s=this.rules.other.startingSpaceChar.test(e)&&this.rules.other.endingSpaceChar.test(e);return n&&s&&(e=e.substring(1,e.length-1)),{type:"codespan",raw:t[0],text:e}}}br(e){const t=this.rules.inline.br.exec(e);if(t)return{type:"br",raw:t[0]}}del(e){const t=this.rules.inline.del.exec(e);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(e){const t=this.rules.inline.autolink.exec(e);if(t){let e,n;return"@"===t[2]?(e=t[1],n="mailto:"+e):(e=t[1],n=e),{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}url(e){let t;if(t=this.rules.inline.url.exec(e)){let e,n;if("@"===t[2])e=t[0],n="mailto:"+e;else{let s;do{s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??""}while(s!==t[0]);e=t[0],n="www."===t[1]?"http://"+t[0]:t[0]}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}}inlineText(e){const t=this.rules.inline.text.exec(e);if(t){const e=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:e}}}}class oe{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||n,this.options.tokenizer=this.options.tokenizer||new re,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:i,block:X.normal,inline:Q.normal};this.options.pedantic?(t.block=X.pedantic,t.inline=Q.pedantic):this.options.gfm&&(t.block=X.gfm,this.options.breaks?t.inline=Q.breaks:t.inline=Q.gfm),this.tokenizer.rules=t}static get rules(){return{block:X,inline:Q}}static lex(e,t){return new oe(t).lex(e)}static lexInline(e,t){return new oe(t).inlineTokens(e)}lex(e){e=e.replace(i.carriageReturn,"\n"),this.blockTokens(e,this.tokens);for(let e=0;e<this.inlineQueue.length;e++){const t=this.inlineQueue[e];this.inlineTokens(t.src,t.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],n=!1){for(this.options.pedantic&&(e=e.replace(i.tabCharGlobal,"    ").replace(i.spaceLine,""));e;){let s;if(this.options.extensions?.block?.some((n=>!!(s=n.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))continue;if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length);const n=t.at(-1);1===s.raw.length&&void 0!==n?n.raw+="\n":t.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length);const n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+s.raw,n.text+="\n"+s.text,this.inlineQueue.at(-1).src=n.text):t.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length);const n=t.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+s.raw,n.text+="\n"+s.raw,this.inlineQueue.at(-1).src=n.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),t.push(s);continue}let r=e;if(this.options.extensions?.startBlock){let t=1/0;const n=e.slice(1);let s;this.options.extensions.startBlock.forEach((e=>{s=e.call({lexer:this},n),"number"==typeof s&&s>=0&&(t=Math.min(t,s))})),t<1/0&&t>=0&&(r=e.substring(0,t+1))}if(this.state.top&&(s=this.tokenizer.paragraph(r))){const o=t.at(-1);n&&"paragraph"===o?.type?(o.raw+="\n"+s.raw,o.text+="\n"+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=o.text):t.push(s),n=r.length!==e.length,e=e.substring(s.raw.length)}else if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length);const n=t.at(-1);"text"===n?.type?(n.raw+="\n"+s.raw,n.text+="\n"+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):t.push(s)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let n=e,s=null;if(this.tokens.links){const e=Object.keys(this.tokens.links);if(e.length>0)for(;null!=(s=this.tokenizer.rules.inline.reflinkSearch.exec(n));)e.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(s=this.tokenizer.rules.inline.anyPunctuation.exec(n));)n=n.slice(0,s.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(s=this.tokenizer.rules.inline.blockSkip.exec(n));)n=n.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let r=!1,o="";for(;e;){let s;if(r||(o=""),r=!1,this.options.extensions?.inline?.some((n=>!!(s=n.call({lexer:this},e,t))&&(e=e.substring(s.raw.length),t.push(s),!0))))continue;if(s=this.tokenizer.escape(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.tag(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.link(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(s.raw.length);const n=t.at(-1);"text"===s.type&&"text"===n?.type?(n.raw+=s.raw,n.text+=s.text):t.push(s);continue}if(s=this.tokenizer.emStrong(e,n,o)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.codespan(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.br(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.del(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.autolink(e)){e=e.substring(s.raw.length),t.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(e))){e=e.substring(s.raw.length),t.push(s);continue}let i=e;if(this.options.extensions?.startInline){let t=1/0;const n=e.slice(1);let s;this.options.extensions.startInline.forEach((e=>{s=e.call({lexer:this},n),"number"==typeof s&&s>=0&&(t=Math.min(t,s))})),t<1/0&&t>=0&&(i=e.substring(0,t+1))}if(s=this.tokenizer.inlineText(i)){e=e.substring(s.raw.length),"_"!==s.raw.slice(-1)&&(o=s.raw.slice(-1)),r=!0;const n=t.at(-1);"text"===n?.type?(n.raw+=s.raw,n.text+=s.text):t.push(s)}else if(e){const t="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(t);break}throw new Error(t)}}return t}}class ie{options;parser;constructor(e){this.options=e||n}space(e){return""}code({text:e,lang:t,escaped:n}){const s=(t||"").match(i.notSpaceStart)?.[0],r=e.replace(i.endingNewline,"")+"\n";return s?'<pre><code class="language-'+V(s)+'">'+(n?r:V(r,!0))+"</code></pre>\n":"<pre><code>"+(n?r:V(r,!0))+"</code></pre>\n"}blockquote({tokens:e}){return`<blockquote>\n${this.parser.parse(e)}</blockquote>\n`}html({text:e}){return e}heading({tokens:e,depth:t}){return`<h${t}>${this.parser.parseInline(e)}</h${t}>\n`}hr(e){return"<hr>\n"}list(e){const t=e.ordered,n=e.start;let s="";for(let t=0;t<e.items.length;t++){const n=e.items[t];s+=this.listitem(n)}const r=t?"ol":"ul";return"<"+r+(t&&1!==n?' start="'+n+'"':"")+">\n"+s+"</"+r+">\n"}listitem(e){let t="";if(e.task){const n=this.checkbox({checked:!!e.checked});e.loose?"paragraph"===e.tokens[0]?.type?(e.tokens[0].text=n+" "+e.tokens[0].text,e.tokens[0].tokens&&e.tokens[0].tokens.length>0&&"text"===e.tokens[0].tokens[0].type&&(e.tokens[0].tokens[0].text=n+" "+V(e.tokens[0].tokens[0].text),e.tokens[0].tokens[0].escaped=!0)):e.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):t+=n+" "}return t+=this.parser.parse(e.tokens,!!e.loose),`<li>${t}</li>\n`}checkbox({checked:e}){return"<input "+(e?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:e}){return`<p>${this.parser.parseInline(e)}</p>\n`}table(e){let t="",n="";for(let t=0;t<e.header.length;t++)n+=this.tablecell(e.header[t]);t+=this.tablerow({text:n});let s="";for(let t=0;t<e.rows.length;t++){const r=e.rows[t];n="";for(let e=0;e<r.length;e++)n+=this.tablecell(r[e]);s+=this.tablerow({text:n})}return s&&(s=`<tbody>${s}</tbody>`),"<table>\n<thead>\n"+t+"</thead>\n"+s+"</table>\n"}tablerow({text:e}){return`<tr>\n${e}</tr>\n`}tablecell(e){const t=this.parser.parseInline(e.tokens),n=e.header?"th":"td";return(e.align?`<${n} align="${e.align}">`:`<${n}>`)+t+`</${n}>\n`}strong({tokens:e}){return`<strong>${this.parser.parseInline(e)}</strong>`}em({tokens:e}){return`<em>${this.parser.parseInline(e)}</em>`}codespan({text:e}){return`<code>${V(e,!0)}</code>`}br(e){return"<br>"}del({tokens:e}){return`<del>${this.parser.parseInline(e)}</del>`}link({href:e,title:t,tokens:n}){const s=this.parser.parseInline(n),r=ee(e);if(null===r)return s;let o='<a href="'+(e=r)+'"';return t&&(o+=' title="'+V(t)+'"'),o+=">"+s+"</a>",o}image({href:e,title:t,text:n,tokens:s}){s&&(n=this.parser.parseInline(s,this.parser.textRenderer));const r=ee(e);if(null===r)return V(n);let o=`<img src="${e=r}" alt="${n}"`;return t&&(o+=` title="${V(t)}"`),o+=">",o}text(e){return"tokens"in e&&e.tokens?this.parser.parseInline(e.tokens):"escaped"in e&&e.escaped?e.text:V(e.text)}}class ae{strong({text:e}){return e}em({text:e}){return e}codespan({text:e}){return e}del({text:e}){return e}html({text:e}){return e}text({text:e}){return e}link({text:e}){return""+e}image({text:e}){return""+e}br(){return""}}class le{options;renderer;textRenderer;constructor(e){this.options=e||n,this.options.renderer=this.options.renderer||new ie,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ae}static parse(e,t){return new le(t).parse(e)}static parseInline(e,t){return new le(t).parseInline(e)}parse(e,t=!0){let n="";for(let s=0;s<e.length;s++){const r=e[s];if(this.options.extensions?.renderers?.[r.type]){const e=r,t=this.options.extensions.renderers[e.type].call({parser:this},e);if(!1!==t||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(e.type)){n+=t||"";continue}}const o=r;switch(o.type){case"space":n+=this.renderer.space(o);continue;case"hr":n+=this.renderer.hr(o);continue;case"heading":n+=this.renderer.heading(o);continue;case"code":n+=this.renderer.code(o);continue;case"table":n+=this.renderer.table(o);continue;case"blockquote":n+=this.renderer.blockquote(o);continue;case"list":n+=this.renderer.list(o);continue;case"html":n+=this.renderer.html(o);continue;case"paragraph":n+=this.renderer.paragraph(o);continue;case"text":{let r=o,i=this.renderer.text(r);for(;s+1<e.length&&"text"===e[s+1].type;)r=e[++s],i+="\n"+this.renderer.text(r);n+=t?this.renderer.paragraph({type:"paragraph",raw:i,text:i,tokens:[{type:"text",raw:i,text:i,escaped:!0}]}):i;continue}default:{const e='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}parseInline(e,t=this.renderer){let n="";for(let s=0;s<e.length;s++){const r=e[s];if(this.options.extensions?.renderers?.[r.type]){const e=this.options.extensions.renderers[r.type].call({parser:this},r);if(!1!==e||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(r.type)){n+=e||"";continue}}const o=r;switch(o.type){case"escape":case"text":n+=t.text(o);break;case"html":n+=t.html(o);break;case"link":n+=t.link(o);break;case"image":n+=t.image(o);break;case"strong":n+=t.strong(o);break;case"em":n+=t.em(o);break;case"codespan":n+=t.codespan(o);break;case"br":n+=t.br(o);break;case"del":n+=t.del(o);break;default:{const e='Token with "'+o.type+'" type was not found.';if(this.options.silent)return console.error(e),"";throw new Error(e)}}}return n}}class ce{options;block;constructor(e){this.options=e||n}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(e){return e}postprocess(e){return e}processAllTokens(e){return e}provideLexer(){return this.block?oe.lex:oe.lexInline}provideParser(){return this.block?le.parse:le.parseInline}}const he=new class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=le;Renderer=ie;TextRenderer=ae;Lexer=oe;Tokenizer=re;Hooks=ce;constructor(...e){this.use(...e)}walkTokens(e,t){let n=[];for(const s of e)switch(n=n.concat(t.call(this,s)),s.type){case"table":{const e=s;for(const s of e.header)n=n.concat(this.walkTokens(s.tokens,t));for(const s of e.rows)for(const e of s)n=n.concat(this.walkTokens(e.tokens,t));break}case"list":{const e=s;n=n.concat(this.walkTokens(e.items,t));break}default:{const e=s;this.defaults.extensions?.childTokens?.[e.type]?this.defaults.extensions.childTokens[e.type].forEach((s=>{const r=e[s].flat(1/0);n=n.concat(this.walkTokens(r,t))})):e.tokens&&(n=n.concat(this.walkTokens(e.tokens,t)))}}return n}use(...e){const t=this.defaults.extensions||{renderers:{},childTokens:{}};return e.forEach((e=>{const n={...e};if(n.async=this.defaults.async||n.async||!1,e.extensions&&(e.extensions.forEach((e=>{if(!e.name)throw new Error("extension name required");if("renderer"in e){const n=t.renderers[e.name];t.renderers[e.name]=n?function(...t){let s=e.renderer.apply(this,t);return!1===s&&(s=n.apply(this,t)),s}:e.renderer}if("tokenizer"in e){if(!e.level||"block"!==e.level&&"inline"!==e.level)throw new Error("extension level must be 'block' or 'inline'");const n=t[e.level];n?n.unshift(e.tokenizer):t[e.level]=[e.tokenizer],e.start&&("block"===e.level?t.startBlock?t.startBlock.push(e.start):t.startBlock=[e.start]:"inline"===e.level&&(t.startInline?t.startInline.push(e.start):t.startInline=[e.start]))}"childTokens"in e&&e.childTokens&&(t.childTokens[e.name]=e.childTokens)})),n.extensions=t),e.renderer){const t=this.defaults.renderer||new ie(this.defaults);for(const n in e.renderer){if(!(n in t))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;const s=n,r=e.renderer[s],o=t[s];t[s]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=o.apply(t,e)),n||""}}n.renderer=t}if(e.tokenizer){const t=this.defaults.tokenizer||new re(this.defaults);for(const n in e.tokenizer){if(!(n in t))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const s=n,r=e.tokenizer[s],o=t[s];t[s]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=o.apply(t,e)),n}}n.tokenizer=t}if(e.hooks){const t=this.defaults.hooks||new ce;for(const n in e.hooks){if(!(n in t))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;const s=n,r=e.hooks[s],o=t[s];ce.passThroughHooks.has(n)?t[s]=e=>{if(this.defaults.async)return Promise.resolve(r.call(t,e)).then((e=>o.call(t,e)));const n=r.call(t,e);return o.call(t,n)}:t[s]=(...e)=>{let n=r.apply(t,e);return!1===n&&(n=o.apply(t,e)),n}}n.hooks=t}if(e.walkTokens){const t=this.defaults.walkTokens,s=e.walkTokens;n.walkTokens=function(e){let n=[];return n.push(s.call(this,e)),t&&(n=n.concat(t.call(this,e))),n}}this.defaults={...this.defaults,...n}})),this}setOptions(e){return this.defaults={...this.defaults,...e},this}lexer(e,t){return oe.lex(e,t??this.defaults)}parser(e,t){return le.parse(e,t??this.defaults)}parseMarkdown(e){return(t,n)=>{const s={...n},r={...this.defaults,...s},o=this.onError(!!r.silent,!!r.async);if(!0===this.defaults.async&&!1===s.async)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==t)return o(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof t)return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));r.hooks&&(r.hooks.options=r,r.hooks.block=e);const i=r.hooks?r.hooks.provideLexer():e?oe.lex:oe.lexInline,a=r.hooks?r.hooks.provideParser():e?le.parse:le.parseInline;if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(t):t).then((e=>i(e,r))).then((e=>r.hooks?r.hooks.processAllTokens(e):e)).then((e=>r.walkTokens?Promise.all(this.walkTokens(e,r.walkTokens)).then((()=>e)):e)).then((e=>a(e,r))).then((e=>r.hooks?r.hooks.postprocess(e):e)).catch(o);try{r.hooks&&(t=r.hooks.preprocess(t));let e=i(t,r);r.hooks&&(e=r.hooks.processAllTokens(e)),r.walkTokens&&this.walkTokens(e,r.walkTokens);let n=a(e,r);return r.hooks&&(n=r.hooks.postprocess(n)),n}catch(e){return o(e)}}}onError(e,t){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",e){const e="<p>An error occurred:</p><pre>"+V(n.message+"",!0)+"</pre>";return t?Promise.resolve(e):e}if(t)return Promise.reject(n);throw n}}};function pe(e,t){return he.parse(e,t)}pe.options=pe.setOptions=function(e){return he.setOptions(e),pe.defaults=he.defaults,s(pe.defaults),pe},pe.getDefaults=t,pe.defaults=n,pe.use=function(...e){return he.use(...e),pe.defaults=he.defaults,s(pe.defaults),pe},pe.walkTokens=function(e,t){return he.walkTokens(e,t)},pe.parseInline=he.parseInline,pe.Parser=le,pe.parser=le.parse,pe.Renderer=ie,pe.TextRenderer=ae,pe.Lexer=oe,pe.lexer=oe.lex,pe.Tokenizer=re,pe.Hooks=ce,pe.parse=pe,pe.options,pe.setOptions,pe.use,pe.walkTokens,pe.parseInline,le.parse,oe.lex;
/*! @license DOMPurify 3.2.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.5/LICENSE */
const{entries:de,setPrototypeOf:ue,isFrozen:ge,getPrototypeOf:me,getOwnPropertyDescriptor:fe}=Object;let{freeze:be,seal:xe,create:ke}=Object,{apply:we,construct:ye}="undefined"!=typeof Reflect&&Reflect;be||(be=function(e){return e}),xe||(xe=function(e){return e}),we||(we=function(e,t,n){return e.apply(t,n)}),ye||(ye=function(e,t){return new e(...t)});const ve=De(Array.prototype.forEach),Te=De(Array.prototype.lastIndexOf),Se=De(Array.prototype.pop),Ee=De(Array.prototype.push),_e=De(Array.prototype.splice),Ae=De(String.prototype.toLowerCase),Ce=De(String.prototype.toString),Re=De(String.prototype.match),Ie=De(String.prototype.replace),Le=De(String.prototype.indexOf),ze=De(String.prototype.trim),Ne=De(Object.prototype.hasOwnProperty),$e=De(RegExp.prototype.test),Me=(Oe=TypeError,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return ye(Oe,t)});var Oe;function De(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];return we(e,t,s)}}function Be(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ae;ue&&ue(e,null);let s=t.length;for(;s--;){let r=t[s];if("string"==typeof r){const e=n(r);e!==r&&(ge(t)||(t[s]=e),r=e)}e[r]=!0}return e}function Fe(e){for(let t=0;t<e.length;t++){Ne(e,t)||(e[t]=null)}return e}function Pe(e){const t=ke(null);for(const[n,s]of de(e)){Ne(e,n)&&(Array.isArray(s)?t[n]=Fe(s):s&&"object"==typeof s&&s.constructor===Object?t[n]=Pe(s):t[n]=s)}return t}function He(e,t){for(;null!==e;){const n=fe(e,t);if(n){if(n.get)return De(n.get);if("function"==typeof n.value)return De(n.value)}e=me(e)}return function(){return null}}const Ue=be(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),qe=be(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),je=be(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),We=be(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ge=be(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Ye=be(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ze=be(["#text"]),Xe=be(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Qe=be(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ke=be(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Je=be(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Ve=xe(/\{\{[\w\W]*|[\w\W]*\}\}/gm),et=xe(/<%[\w\W]*|[\w\W]*%>/gm),tt=xe(/\$\{[\w\W]*/gm),nt=xe(/^data-[\-\w.\u00B7-\uFFFF]+$/),st=xe(/^aria-[\-\w]+$/),rt=xe(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),ot=xe(/^(?:\w+script|data):/i),it=xe(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),at=xe(/^html$/i),lt=xe(/^[a-z][.\w]*(-[.\w]+)+$/i);var ct=Object.freeze({__proto__:null,ARIA_ATTR:st,ATTR_WHITESPACE:it,CUSTOM_ELEMENT:lt,DATA_ATTR:nt,DOCTYPE_NAME:at,ERB_EXPR:et,IS_ALLOWED_URI:rt,IS_SCRIPT_OR_DATA:ot,MUSTACHE_EXPR:Ve,TMPLIT_EXPR:tt});const ht=1,pt=3,dt=7,ut=8,gt=9,mt=function(){return"undefined"==typeof window?null:window};var ft=function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mt();const n=t=>e(t);if(n.version="3.2.5",n.removed=[],!t||!t.document||t.document.nodeType!==gt||!t.Element)return n.isSupported=!1,n;let{document:s}=t;const r=s,o=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:a,Node:l,Element:c,NodeFilter:h,NamedNodeMap:p=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:u,trustedTypes:g}=t,m=c.prototype,f=He(m,"cloneNode"),b=He(m,"remove"),x=He(m,"nextSibling"),k=He(m,"childNodes"),w=He(m,"parentNode");if("function"==typeof a){const e=s.createElement("template");e.content&&e.content.ownerDocument&&(s=e.content.ownerDocument)}let y,v="";const{implementation:T,createNodeIterator:S,createDocumentFragment:E,getElementsByTagName:_}=s,{importNode:A}=r;let C={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]};n.isSupported="function"==typeof de&&"function"==typeof w&&T&&void 0!==T.createHTMLDocument;const{MUSTACHE_EXPR:R,ERB_EXPR:I,TMPLIT_EXPR:L,DATA_ATTR:z,ARIA_ATTR:N,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:M,CUSTOM_ELEMENT:O}=ct;let{IS_ALLOWED_URI:D}=ct,B=null;const F=Be({},[...Ue,...qe,...je,...Ge,...Ze]);let P=null;const H=Be({},[...Xe,...Qe,...Ke,...Je]);let U=Object.seal(ke(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),q=null,j=null,W=!0,G=!0,Y=!1,Z=!0,X=!1,Q=!0,K=!1,J=!1,V=!1,ee=!1,te=!1,ne=!1,se=!0,re=!1,oe=!0,ie=!1,ae={},le=null;const ce=Be({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let he=null;const pe=Be({},["audio","video","img","source","image","track"]);let ue=null;const ge=Be({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),me="http://www.w3.org/1998/Math/MathML",fe="http://www.w3.org/2000/svg",xe="http://www.w3.org/1999/xhtml";let we=xe,ye=!1,Oe=null;const De=Be({},[me,fe,xe],Ce);let Fe=Be({},["mi","mo","mn","ms","mtext"]),Ve=Be({},["annotation-xml"]);const et=Be({},["title","style","font","a","script"]);let tt=null;const nt=["application/xhtml+xml","text/html"];let st=null,ot=null;const it=s.createElement("form"),lt=function(e){return e instanceof RegExp||e instanceof Function},ft=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ot||ot!==e){if(e&&"object"==typeof e||(e={}),e=Pe(e),tt=-1===nt.indexOf(e.PARSER_MEDIA_TYPE)?"text/html":e.PARSER_MEDIA_TYPE,st="application/xhtml+xml"===tt?Ce:Ae,B=Ne(e,"ALLOWED_TAGS")?Be({},e.ALLOWED_TAGS,st):F,P=Ne(e,"ALLOWED_ATTR")?Be({},e.ALLOWED_ATTR,st):H,Oe=Ne(e,"ALLOWED_NAMESPACES")?Be({},e.ALLOWED_NAMESPACES,Ce):De,ue=Ne(e,"ADD_URI_SAFE_ATTR")?Be(Pe(ge),e.ADD_URI_SAFE_ATTR,st):ge,he=Ne(e,"ADD_DATA_URI_TAGS")?Be(Pe(pe),e.ADD_DATA_URI_TAGS,st):pe,le=Ne(e,"FORBID_CONTENTS")?Be({},e.FORBID_CONTENTS,st):ce,q=Ne(e,"FORBID_TAGS")?Be({},e.FORBID_TAGS,st):{},j=Ne(e,"FORBID_ATTR")?Be({},e.FORBID_ATTR,st):{},ae=!!Ne(e,"USE_PROFILES")&&e.USE_PROFILES,W=!1!==e.ALLOW_ARIA_ATTR,G=!1!==e.ALLOW_DATA_ATTR,Y=e.ALLOW_UNKNOWN_PROTOCOLS||!1,Z=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,X=e.SAFE_FOR_TEMPLATES||!1,Q=!1!==e.SAFE_FOR_XML,K=e.WHOLE_DOCUMENT||!1,ee=e.RETURN_DOM||!1,te=e.RETURN_DOM_FRAGMENT||!1,ne=e.RETURN_TRUSTED_TYPE||!1,V=e.FORCE_BODY||!1,se=!1!==e.SANITIZE_DOM,re=e.SANITIZE_NAMED_PROPS||!1,oe=!1!==e.KEEP_CONTENT,ie=e.IN_PLACE||!1,D=e.ALLOWED_URI_REGEXP||rt,we=e.NAMESPACE||xe,Fe=e.MATHML_TEXT_INTEGRATION_POINTS||Fe,Ve=e.HTML_INTEGRATION_POINTS||Ve,U=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&lt(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(U.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&lt(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(U.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(U.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),X&&(G=!1),te&&(ee=!0),ae&&(B=Be({},Ze),P=[],!0===ae.html&&(Be(B,Ue),Be(P,Xe)),!0===ae.svg&&(Be(B,qe),Be(P,Qe),Be(P,Je)),!0===ae.svgFilters&&(Be(B,je),Be(P,Qe),Be(P,Je)),!0===ae.mathMl&&(Be(B,Ge),Be(P,Ke),Be(P,Je))),e.ADD_TAGS&&(B===F&&(B=Pe(B)),Be(B,e.ADD_TAGS,st)),e.ADD_ATTR&&(P===H&&(P=Pe(P)),Be(P,e.ADD_ATTR,st)),e.ADD_URI_SAFE_ATTR&&Be(ue,e.ADD_URI_SAFE_ATTR,st),e.FORBID_CONTENTS&&(le===ce&&(le=Pe(le)),Be(le,e.FORBID_CONTENTS,st)),oe&&(B["#text"]=!0),K&&Be(B,["html","head","body"]),B.table&&(Be(B,["tbody"]),delete q.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw Me('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw Me('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');y=e.TRUSTED_TYPES_POLICY,v=y.createHTML("")}else void 0===y&&(y=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let n=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(n=t.getAttribute(s));const r="dompurify"+(n?"#"+n:"");try{return e.createPolicy(r,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+r+" could not be created."),null}}(g,o)),null!==y&&"string"==typeof v&&(v=y.createHTML(""));be&&be(e),ot=e}},bt=Be({},[...qe,...je,...We]),xt=Be({},[...Ge,...Ye]),kt=function(e){Ee(n.removed,{element:e});try{w(e).removeChild(e)}catch(t){b(e)}},wt=function(e,t){try{Ee(n.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){Ee(n.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e)if(ee||te)try{kt(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},yt=function(e){let t=null,n=null;if(V)e="<remove></remove>"+e;else{const t=Re(e,/^[\r\n\t ]+/);n=t&&t[0]}"application/xhtml+xml"===tt&&we===xe&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const r=y?y.createHTML(e):e;if(we===xe)try{t=(new u).parseFromString(r,tt)}catch(e){}if(!t||!t.documentElement){t=T.createDocument(we,"template",null);try{t.documentElement.innerHTML=ye?v:r}catch(e){}}const o=t.body||t.documentElement;return e&&n&&o.insertBefore(s.createTextNode(n),o.childNodes[0]||null),we===xe?_.call(t,K?"html":"body")[0]:K?t.documentElement:o},vt=function(e){return S.call(e.ownerDocument||e,e,h.SHOW_ELEMENT|h.SHOW_COMMENT|h.SHOW_TEXT|h.SHOW_PROCESSING_INSTRUCTION|h.SHOW_CDATA_SECTION,null)},Tt=function(e){return e instanceof d&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof p)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},St=function(e){return"function"==typeof l&&e instanceof l};function Et(e,t,s){ve(e,(e=>{e.call(n,t,s,ot)}))}const _t=function(e){let t=null;if(Et(C.beforeSanitizeElements,e,null),Tt(e))return kt(e),!0;const s=st(e.nodeName);if(Et(C.uponSanitizeElement,e,{tagName:s,allowedTags:B}),e.hasChildNodes()&&!St(e.firstElementChild)&&$e(/<[/\w!]/g,e.innerHTML)&&$e(/<[/\w!]/g,e.textContent))return kt(e),!0;if(e.nodeType===dt)return kt(e),!0;if(Q&&e.nodeType===ut&&$e(/<[/\w]/g,e.data))return kt(e),!0;if(!B[s]||q[s]){if(!q[s]&&Ct(s)){if(U.tagNameCheck instanceof RegExp&&$e(U.tagNameCheck,s))return!1;if(U.tagNameCheck instanceof Function&&U.tagNameCheck(s))return!1}if(oe&&!le[s]){const t=w(e)||e.parentNode,n=k(e)||e.childNodes;if(n&&t){for(let s=n.length-1;s>=0;--s){const r=f(n[s],!0);r.__removalCount=(e.__removalCount||0)+1,t.insertBefore(r,x(e))}}}return kt(e),!0}return e instanceof c&&!function(e){let t=w(e);t&&t.tagName||(t={namespaceURI:we,tagName:"template"});const n=Ae(e.tagName),s=Ae(t.tagName);return!!Oe[e.namespaceURI]&&(e.namespaceURI===fe?t.namespaceURI===xe?"svg"===n:t.namespaceURI===me?"svg"===n&&("annotation-xml"===s||Fe[s]):Boolean(bt[n]):e.namespaceURI===me?t.namespaceURI===xe?"math"===n:t.namespaceURI===fe?"math"===n&&Ve[s]:Boolean(xt[n]):e.namespaceURI===xe?!(t.namespaceURI===fe&&!Ve[s])&&!(t.namespaceURI===me&&!Fe[s])&&!xt[n]&&(et[n]||!bt[n]):!("application/xhtml+xml"!==tt||!Oe[e.namespaceURI]))}(e)?(kt(e),!0):"noscript"!==s&&"noembed"!==s&&"noframes"!==s||!$e(/<\/no(script|embed|frames)/i,e.innerHTML)?(X&&e.nodeType===pt&&(t=e.textContent,ve([R,I,L],(e=>{t=Ie(t,e," ")})),e.textContent!==t&&(Ee(n.removed,{element:e.cloneNode()}),e.textContent=t)),Et(C.afterSanitizeElements,e,null),!1):(kt(e),!0)},At=function(e,t,n){if(se&&("id"===t||"name"===t)&&(n in s||n in it))return!1;if(G&&!j[t]&&$e(z,t));else if(W&&$e(N,t));else if(!P[t]||j[t]){if(!(Ct(e)&&(U.tagNameCheck instanceof RegExp&&$e(U.tagNameCheck,e)||U.tagNameCheck instanceof Function&&U.tagNameCheck(e))&&(U.attributeNameCheck instanceof RegExp&&$e(U.attributeNameCheck,t)||U.attributeNameCheck instanceof Function&&U.attributeNameCheck(t))||"is"===t&&U.allowCustomizedBuiltInElements&&(U.tagNameCheck instanceof RegExp&&$e(U.tagNameCheck,n)||U.tagNameCheck instanceof Function&&U.tagNameCheck(n))))return!1}else if(ue[t]);else if($e(D,Ie(n,M,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==Le(n,"data:")||!he[e]){if(Y&&!$e($,Ie(n,M,"")));else if(n)return!1}else;return!0},Ct=function(e){return"annotation-xml"!==e&&Re(e,O)},Rt=function(e){Et(C.beforeSanitizeAttributes,e,null);const{attributes:t}=e;if(!t||Tt(e))return;const s={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:P,forceKeepAttr:void 0};let r=t.length;for(;r--;){const o=t[r],{name:i,namespaceURI:a,value:l}=o,c=st(i);let h="value"===i?l:ze(l);if(s.attrName=c,s.attrValue=h,s.keepAttr=!0,s.forceKeepAttr=void 0,Et(C.uponSanitizeAttribute,e,s),h=s.attrValue,!re||"id"!==c&&"name"!==c||(wt(i,e),h="user-content-"+h),Q&&$e(/((--!?|])>)|<\/(style|title)/i,h)){wt(i,e);continue}if(s.forceKeepAttr)continue;if(wt(i,e),!s.keepAttr)continue;if(!Z&&$e(/\/>/i,h)){wt(i,e);continue}X&&ve([R,I,L],(e=>{h=Ie(h,e," ")}));const p=st(e.nodeName);if(At(p,c,h)){if(y&&"object"==typeof g&&"function"==typeof g.getAttributeType)if(a);else switch(g.getAttributeType(p,c)){case"TrustedHTML":h=y.createHTML(h);break;case"TrustedScriptURL":h=y.createScriptURL(h)}try{a?e.setAttributeNS(a,i,h):e.setAttribute(i,h),Tt(e)?kt(e):Se(n.removed)}catch(e){}}}Et(C.afterSanitizeAttributes,e,null)},It=function e(t){let n=null;const s=vt(t);for(Et(C.beforeSanitizeShadowDOM,t,null);n=s.nextNode();)Et(C.uponSanitizeShadowNode,n,null),_t(n),Rt(n),n.content instanceof i&&e(n.content);Et(C.afterSanitizeShadowDOM,t,null)};return n.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null,o=null,a=null,c=null;if(ye=!e,ye&&(e="\x3c!--\x3e"),"string"!=typeof e&&!St(e)){if("function"!=typeof e.toString)throw Me("toString is not a function");if("string"!=typeof(e=e.toString()))throw Me("dirty is not a string, aborting")}if(!n.isSupported)return e;if(J||ft(t),n.removed=[],"string"==typeof e&&(ie=!1),ie){if(e.nodeName){const t=st(e.nodeName);if(!B[t]||q[t])throw Me("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof l)s=yt("\x3c!----\x3e"),o=s.ownerDocument.importNode(e,!0),o.nodeType===ht&&"BODY"===o.nodeName||"HTML"===o.nodeName?s=o:s.appendChild(o);else{if(!ee&&!X&&!K&&-1===e.indexOf("<"))return y&&ne?y.createHTML(e):e;if(s=yt(e),!s)return ee?null:ne?v:""}s&&V&&kt(s.firstChild);const h=vt(ie?e:s);for(;a=h.nextNode();)_t(a),Rt(a),a.content instanceof i&&It(a.content);if(ie)return e;if(ee){if(te)for(c=E.call(s.ownerDocument);s.firstChild;)c.appendChild(s.firstChild);else c=s;return(P.shadowroot||P.shadowrootmode)&&(c=A.call(r,c,!0)),c}let p=K?s.outerHTML:s.innerHTML;return K&&B["!doctype"]&&s.ownerDocument&&s.ownerDocument.doctype&&s.ownerDocument.doctype.name&&$e(at,s.ownerDocument.doctype.name)&&(p="<!DOCTYPE "+s.ownerDocument.doctype.name+">\n"+p),X&&ve([R,I,L],(e=>{p=Ie(p,e," ")})),y&&ne?y.createHTML(p):p},n.setConfig=function(){ft(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),J=!0},n.clearConfig=function(){ot=null,J=!1},n.isValidAttribute=function(e,t,n){ot||ft({});const s=st(e),r=st(t);return At(s,r,n)},n.addHook=function(e,t){"function"==typeof t&&Ee(C[e],t)},n.removeHook=function(e,t){if(void 0!==t){const n=Te(C[e],t);return-1===n?void 0:_e(C[e],n,1)[0]}return Se(C[e])},n.removeHooks=function(e){C[e]=[]},n.removeAllHooks=function(){C={afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}},n}();function bt(e){const t=pe(e,{mangle:!1,headerIds:!1});return ft.sanitize(t)}class xt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._content=""}connectedCallback(){const e=this.getAttribute("sender")||"bot",t=this.getAttribute("avatar")||"https://alaghbry0.github.io/chat-widget/profile.png",n=this.getAttribute("message-id")||"";this._content=this.getAttribute("data-md")||this.textContent||"";const s=document.createElement("style");s.textContent='\n      :host { display: block; width: 115%; margin-bottom: 16px; }\n\n      .message {\n        display: flex;\n        flex-direction: column;\n        max-width: 80%;\n        animation: fadeIn 0.3s ease-in-out, slideIn 0.2s ease-out;\n      }\n\n      .message-user {\n        align-self: flex-end;\n        align-items: flex-end;\n      }\n\n      .message-bot {\n        align-self: flex-start;\n        align-items: flex-start;\n      }\n\n      .message-header {\n        display: flex;\n        align-items: center;\n        margin-bottom: 4px;\n      }\n\n      .avatar {\n        width: 28px;\n        height: 28px;\n        border-radius: 50%;\n        margin-right: 8px;\n        background-color: var(--primary-color);\n        color: #fff;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 14px;\n        font-weight: bold;\n      }\n\n      .message-content {\n        padding: 5px 10px;\n        border-radius: 16px;\n        font-size: 14px;\n        line-height: 1.6;\n        position: relative;\n        overflow-wrap: break-word;\n        word-break: break-word;\n      }\n\n      .message-user .message-content {\n        background: linear-gradient(135deg, #007BFF, #0056b3);\n        color: #fff;\n        border-bottom-right-radius: 4px;\n      }\n\n      .message-bot .message-content {\n        background: linear-gradient(135deg, #F8F9FA, #FFFFFF);\n        color: #333;\n        border-bottom-left-radius: 4px;\n        box-shadow: 0 1px 2px rgba(0,0,0,0.1);\n      }\n\n      .message-time {\n        font-size: 11px;\n        color: var(--text-secondary);\n        margin-top: 4px;\n        opacity: 0.8;\n      }\n\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n\n      @keyframes slideIn {\n        from { transform: translateY(10px); }\n        to { transform: translateY(0); }\n      }\n\n      /* تنسيقات العناصر في الرسالة */\n      .message-content h1, .message-content h2, .message-content h3 {\n        margin: 12px 0 8px 0;\n        font-weight: 600;\n      }\n\n      .message-content h1 { font-size: 16px; }\n      .message-content h2 { font-size: 14px; }\n      .message-content h3 { font-size: 13px; }\n\n      /* تنسيقات القوائم */\n      .message-content ul, .message-content ol {\n        padding-left: 20px;\n        margin: 8px 0;\n      }\n\n      .message-content li {\n        margin-bottom: 4px;\n      }\n\n      .message-content li.nested {\n        margin-left: 16px;\n      }\n\n      /* تنسيقات الروابط - معدّلة لتشبه الأزرار */\n      .message-content a {\n        color: inherit;\n        text-decoration: none;\n        display: inline-block;\n        padding: 6px 12px;\n        background: rgba(0, 0, 0, 0.1);\n        border-radius: 16px;\n        transition: background 0.2s ease;\n      }\n\n      .message-user .message-content a {\n        color: #fff;\n        background: rgba(255, 255, 255, 0.2);\n      }\n\n      .message-bot .message-content a {\n        color: #007BFF;\n        background: rgba(0, 123, 255, 0.1);\n      }\n\n      .message-content a::after {\n        content: " ↗";\n        font-size: 0.8em;\n        opacity: 0.8;\n      }\n\n      /* تنسيقات الكود */\n      .message-content code {\n        background: rgba(0,0,0,0.1);\n        border-radius: 3px;\n        padding: 2px 4px;\n        font-family: monospace;\n      }\n\n      .message-user .message-content code {\n        background: rgba(255,255,255,0.2);\n      }\n\n      /* أزرار التفاعل */\n      .message-actions {\n        display: none;\n        position: absolute;\n        top: -16px;\n        right: 0;\n        background: #fff;\n        border-radius: 4px;\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n      }\n\n      .message:hover .message-actions {\n        display: flex;\n      }\n\n      .action-button {\n        padding: 4px 8px;\n        background: #fff;\n        color: #666;\n        border: none;\n        cursor: pointer;\n        font-size: 12px;\n        border-radius: 4px;\n      }\n\n      .action-button:hover {\n        background: #f1f1f1;\n      }\n    ';const r=document.createElement("div");r.className=`message message-${e}`,r.setAttribute("data-message-id",n);const o=bt(this._content);r.innerHTML=`\n      <div class="message-header">\n        ${"bot"===e?t?`<img class="avatar" src="${t}" alt="Bot Avatar">`:'<div class="avatar">B</div>':""}\n      </div>\n      <div class="message-content">${o}</div>\n      <div class="message-time">${this._formatTime(new Date)}</div>\n      ${"bot"===e?'\n        <div class="message-actions">\n          <button class="action-button copy-btn">نسخ</button>\n        </div>\n      ':""}\n    `,this.shadowRoot.append(s,r),this._activateControls(),this._setupLinkTargets()}updateContent(e){if(e===this._content)return;this._content=e;const t=this.shadowRoot.querySelector(".message-content");t&&(t.innerHTML=bt(e),this._activateControls(),this._setupLinkTargets())}_activateControls(){const e=this.shadowRoot.querySelector(".copy-btn");e&&e.addEventListener("click",(()=>{navigator.clipboard.writeText(this._content).then((()=>{e.textContent="تم النسخ",setTimeout((()=>{e.textContent="نسخ"}),2e3)})).catch((e=>{console.error("فشل النسخ:",e)}))}))}_setupLinkTargets(){this.shadowRoot.querySelectorAll(".message-content a").forEach((e=>{e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")}))}_formatTime(e){return`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}}customElements.define("chat-message",xt);class kt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._suggestions=[]}connectedCallback(){this._render()}set suggestions(e){Array.isArray(e)&&(this._suggestions=e,this.shadowRoot&&this._render())}get suggestions(){return this._suggestions}_render(){const e=document.createElement("style");e.textContent="\n      :host {\n        display: block;\n        margin: 16px 0;\n      }\n\n      .suggestions {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin-top: 16px;\n      }\n\n      .suggestion {\n        background: linear-gradient(to right, #F8F9FA, #FFFFFF);\n        color: var(--text-color, #333);\n        border: 1px solid var(--border-color, #E6E6E6);\n        border-radius: 16px;\n        padding: 8px 16px;\n        font-size: 13px;\n        cursor: pointer;\n        transition: all 0.2s;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        max-width: 200px;\n        box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n      }\n\n      .suggestion:hover {\n        background: linear-gradient(to right, var(--primary-color, #007BFF), var(--primary-hover, #0056b3));\n        color: white;\n        transform: translateY(-2px);\n        box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n      }\n\n      .title {\n        font-size: 14px;\n        color: var(--text-secondary, #666);\n        margin-bottom: 8px;\n      }\n\n      @keyframes fadeIn {\n        from { opacity: 0; transform: translateY(10px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n\n      .suggestion {\n        animation: fadeIn 0.3s ease-in-out;\n        animation-fill-mode: both;\n      }\n\n      .suggestion:nth-child(1) { animation-delay: 0.1s; }\n      .suggestion:nth-child(2) { animation-delay: 0.2s; }\n      .suggestion:nth-child(3) { animation-delay: 0.3s; }\n      .suggestion:nth-child(4) { animation-delay: 0.4s; }\n\n      @media (max-width: 576px) {\n        .suggestions {\n          gap: 6px;\n        }\n\n        .suggestion {\n          padding: 6px 12px;\n          font-size: 12px;\n        }\n      }\n    ";const t=document.createElement("div");t.innerHTML=`\n      <div class="title">يمكنك أن تسأل:</div>\n      <div class="suggestions">\n        ${this._suggestions.map((e=>`\n          <button class="suggestion" aria-label="${e}">${e}</button>\n        `)).join("")}\n      </div>\n    `,this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t);this.shadowRoot.querySelectorAll(".suggestion").forEach((e=>{e.addEventListener("click",(()=>{const t=e.textContent;this.dispatchEvent(new CustomEvent("suggestion-clicked",{detail:{suggestion:t},bubbles:!0,composed:!0}))}))}))}}customElements.define("chat-suggestions",kt);class wt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){const e=this.getAttribute("avatar")||"",t=document.dir||this.getAttribute("direction")||"rtl",n=document.createElement("style");n.textContent=`\n      :host {\n        display: block;\n        width: 100%;\n        animation: fadeIn 0.3s ease-in-out;\n      }\n\n      .typing-indicator {\n        display: flex;\n        align-items: flex-end;\n        margin-bottom: 10px;\n        max-width: 85%;\n        align-self: flex-start;\n      }\n\n      .avatar {\n        width: 28px;\n        height: 28px;\n        border-radius: 50%;\n        margin-right: ${"rtl"===t?"0":"8px"};\n        margin-left: ${"rtl"===t?"8px":"0"};\n        background-color: var(--primary-color, #007BFF);\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 14px;\n        font-weight: bold;\n        flex-shrink: 0;\n      }\n\n      .typing-bubble {\n        background: transparent;\n        padding: 8px 12px;\n        display: flex;\n        align-items: center;\n      }\n\n      .dots-container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 20px;\n      }\n\n      .dot {\n        width: 6px;\n        height: 6px;\n        background-color: var(--text-secondary, #666);\n        border-radius: 50%;\n        margin: 0 2px;\n        opacity: 0.7;\n        transition: transform 0.2s ease-in-out;\n        animation: bounce 1.2s infinite;\n      }\n\n      .dot:nth-child(1) {\n        animation-delay: 0s;\n      }\n\n      .dot:nth-child(2) {\n        animation-delay: 0.2s;\n      }\n\n      .dot:nth-child(3) {\n        animation-delay: 0.4s;\n      }\n\n      @keyframes bounce {\n        0%, 60%, 100% {\n          transform: translateY(0);\n        }\n        30% {\n          transform: translateY(-4px);\n        }\n      }\n\n      @keyframes fadeIn {\n        from { opacity: 0; transform: translateY(10px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n    `;const s=e?`<img class="avatar" src="${e}" alt="Bot" />`:`<div class="avatar">${this.getAttribute("avatar-text")||"B"}</div>`,r=document.createElement("div");r.className="typing-indicator",r.innerHTML=`\n      ${s}\n      <div class="typing-bubble">\n        <div class="dots-container">\n          <div class="dot"></div>\n          <div class="dot"></div>\n          <div class="dot"></div>\n        </div>\n      </div>\n    `,this.shadowRoot.appendChild(n),this.shadowRoot.appendChild(r)}updateAvatar(e){const t=this.shadowRoot.querySelector(".avatar");if(t&&e)if("IMG"===t.tagName)t.src=e;else{const n=t.parentNode,s=document.createElement("img");s.className="avatar",s.src=e,s.alt="Bot",n.replaceChild(s,t)}}}customElements.define("typing-indicator",wt);class yt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this._render()}_render(){const e=this.getAttribute("src")||"",t=this.getAttribute("fallback")||"B",n=this.getAttribute("bg-color")||"#007BFF",s=this.getAttribute("size")||"32px",r=document.createElement("style");r.textContent=`\n      :host {\n        display: inline-block;\n      }\n\n      .avatar {\n        width: ${s};\n        height: ${s};\n        border-radius: 50%;\n        overflow: hidden;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-weight: 600;\n        color: white;\n        background: linear-gradient(135deg, ${n}, ${this._darkenColor(n,20)});\n        font-size: calc(${s} * 0.4);\n        box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        transition: transform 0.2s ease-out;\n      }\n\n      .avatar:hover {\n        transform: scale(1.05);\n      }\n\n      .avatar img {\n        width: 100%;\n        height: 100%;\n        object-fit: cover;\n        transition: opacity 0.2s;\n      }\n\n      @keyframes avatarFadeIn {\n        from { opacity: 0; transform: scale(0.8); }\n        to { opacity: 1; transform: scale(1); }\n      }\n\n      .avatar {\n        animation: avatarFadeIn 0.3s ease-out forwards;\n      }\n    `;const o=document.createElement("template");o.innerHTML=e?`\n        <div class="avatar">\n          <img src="${e}" alt="Avatar" onerror="this.style.display='none'; this.parentNode.textContent='${t}'" />\n        </div>\n      `:`\n        <div class="avatar">${t}</div>\n      `,this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(r),this.shadowRoot.appendChild(o.content.cloneNode(!0))}_darkenColor(e,t){const n=parseInt(e.replace("#",""),16),s=Math.round(2.55*t),r=(n>>16)-s,o=(n>>8&255)-s,i=(255&n)-s;return"#"+(16777216+65536*(r<0?0:r)+256*(o<0?0:o)+(i<0?0:i)).toString(16).slice(1)}static get observedAttributes(){return["src","fallback","bg-color","size"]}attributeChangedCallback(e,t,n){t!==n&&this._render()}}customElements.define("chat-avatar",yt);class vt{async sendMessage(e,t){try{console.log("Sending message to:",e,t);const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=n.body.getReader(),r=new TextDecoder,o={listeners:{message:[],chunk:[],end:[],tool_call:[],tool_result:[],error:[],open:[]},onmessage:null,onchunk:null,onend:null,ontool_call:null,ontool_result:null,onerror:null,onopen:null,onclose:null,addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},removeEventListener(e,t){const n=this.listeners[e]||[],s=n.indexOf(t);-1!==s&&n.splice(s,1)},close(){s.cancel().then((()=>{this.onclose&&this.onclose({type:"close"}),(this.listeners.close||[]).forEach((e=>e({type:"close"})))}))}};return this._processStream(s,r,o),setTimeout((()=>{o.onopen&&o.onopen({type:"open"}),(o.listeners.open||[]).forEach((e=>e({type:"open"})))}),0),o}catch(e){throw console.error("Error in sendMessage:",e),e}}_processStream(e,t,n){let s="",r=null;const o=(e,t,s)=>{try{const r={data:t,type:e,lastEventId:s,json:JSON.parse(t)},o=n["on"+e]||n.onmessage;o&&o(r),(n.listeners[e]||[]).forEach((e=>e(r)))}catch(r){const o={data:t,type:e,lastEventId:s},i=n["on"+e]||n.onmessage;i&&i(o),(n.listeners[e]||[]).forEach((e=>e(o)))}},i=()=>(r=e.read().then((({value:e,done:n})=>{if(n)return void o("end","","");return(e=>{s+=e;const t=s.split(/\r?\n\r?\n/);s=t.pop()||"",t.forEach((e=>{if(!e.trim())return;const t=e.split(/\r?\n/);let n="message",s="",r="";t.forEach((e=>{e.startsWith("event:")?n=e.substring(6).trim():e.startsWith("data:")?s+=(s?"\n":"")+e.substring(5).trim():e.startsWith("id:")?r=e.substring(3).trim():e.startsWith(":")})),s&&o(n,s,r)}))})(t.decode(e,{stream:!0})),i()})).catch((e=>{console.error("Error reading stream:",e),o("error",JSON.stringify({message:e.message||"Error reading stream"}),"")})),r);i()}}class Tt extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.isOpen=!1,this.messages=[],this.isTyping=!1,this.sessionId=this._generateSessionId(),this.headerCollapsed=!1,this.lastScrollPosition=0,this._initialize()}static get observedAttributes(){return["project-id","theme","position","welcome-message","api-url","direction","avatar","title","subtitle","powered-by"]}_resetChat(){console.log("🔄 Resetting chat to initial state..."),this.messages=[],this.sessionId=this._generateSessionId(!0),this._render(),this.isOpen&&(this.chatContainer?(this.chatContainer.classList.add("open"),console.log("Restored .open class after reset.")):console.error("Chat container not found immediately after render in _resetChat.")),this._setupInternalListeners(),this._setupInitialChatState(),console.log("Chat reset complete.")}_initialize(){this.chatService=new vt,this.suggestionsElement=null,this._render(),this._setupComponentListeners(),this._setupInternalListeners(),this._setupInitialChatState(),console.log("Chat widget initialized.")}_render(){const e=document.createElement("style");e.textContent='\n  :host {\n    --primary-color: #007BFF;\n    --primary-hover: #0069d9;\n    --bg-color: #fff;\n    --header-bg: #467df2;\n    --text-color: #333;\n    --text-secondary: #666;\n    --message-bg-user: linear-gradient(180deg, #007BFF, #0056B3);\n    --message-color-user: #fff;\n    --message-bg-bot: linear-gradient(180deg, #F8F9FA, #FFFFFF);\n    --message-color-bot: #666;\n    --border-color: #f7eded;\n    --footer-bg: rgba(249, 250, 251, 0.8);\n    --bubble-size: 56px;\n    --shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    --header-dark: #1F2937;\n\n    font-family: Roboto, Inter, -apple-system, BlinkMacSystemFont, \'Segoe UI\', \'Helvetica Neue\', Arial, sans-serif;\n    position: fixed;\n    z-index: 9999;\n    box-sizing: border-box;\n  }\n\n  :host([theme="dark"]) {\n    --primary-color: #375FFF;\n    --primary-hover: #2D4ECC;\n    --bg-color: #F0F0F0;\n    --header-bg: #2D2D2D;\n    --header-dark: #0F172A;\n    --text-color: #fff;\n    --text-secondary: #B0B0B0;\n    --message-bg-user: linear-gradient(180deg, #375FFF, #2D4ECC);\n    --message-color-user: #fff;\n    --message-bg-bot: linear-gradient(180deg, #2D2D2D, #1E1E1E);\n    --message-color-bot: #E0E0E0;\n    --border-color: #3D3D3D;\n    --footer-bg: rgba(30, 30, 30, 0.85);\n  }\n\n  :host([position="bottom-right"]) .chat-container {\n    bottom: calc(var(--bubble-size) + 17px);\n    right: 24px;\n    left: auto;\n  }\n\n  :host([position="bottom-left"]) .chat-container {\n    bottom: calc(var(--bubble-size) + 16px);\n    left: 24px;\n    right: auto;\n  }\n\n  :host([direction="rtl"]) {\n    direction: rtl;\n    text-align: right;\n  }\n\n  .chat-container {\n    z-index: 9999;\n    position: fixed;\n    display: flex;\n    flex-direction: column;\n    width: 400px;\n    max-width: 90vw;\n    height: 85vh;\n    background-color: var(--bg-color);\n    border-radius: 15px;\n    overflow: hidden;\n    box-shadow: var(--shadow);\n    transition: transform 0.3s ease, opacity 0.3s ease;\n    transform: translateY(16px);\n    opacity: 0;\n    pointer-events: none;\n  }\n\n  .chat-container.open {\n    transform: translateY(0);\n    opacity: 1;\n    pointer-events: all;\n  }\n\n  .chat-header {\n  display: flex;\n  flex-direction: column;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  z-index: 10;\n  transition: height 0.3s ease;\n  transform: translateZ(0); /* تحسين الأداء */\n}\n\n\n\n/* حساب ارتفاع messages-container مع أخذ الهيدر في الاعتبار */\n.messages-container {\n  padding-top: 12px;\n  height: 100%;\n}\n\n  .top-bar {\n    height: 55px;\n    background-color: var(--header-dark);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 16px;\n  }\n\n  .top-bar-title {\n    color: white;\n    font-size: 14px;\n    font-weight: 600;\n    margin: 0;\n  }\n\n  .top-bar-actions {\n    display: flex;\n    gap: 8px;\n  }\n\n  .top-bar-button {\n    width: 24px;\n    height: 24px;\n    padding: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: none;\n    border: none;\n    cursor: pointer;\n    color: white;\n    opacity: 0.8;\n  }\n\n  .top-bar-button:hover {\n    opacity: 1;\n  }\n\n  .profile-header {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    background-color: white;\n    padding: 16px 0;\n    transition: transform 0.3s ease, opacity 0.3s ease, max-height 0.3s ease;\n    max-height: 150px;\n    overflow: hidden;\n  }\n\n  .profile-header.hidden {\n    max-height: 0;\n    padding: 0;\n    opacity: 0;\n    transform: translateY(-100%);\n  }\n\n  .profile-avatar {\n    width: 64px;\n    height: 64px;\n  }\n\n  .header-title {\n    font-size: 20px;\n    font-weight: 600;\n    color: var(--text-color);\n    margin: 8px 0 0 0;\n  }\n\n  .header-subtitle {\n    font-size: 14px;\n    color: var(--text-secondary);\n    margin: 8px 0 0 0;\n  }\n\n  .messages-container {\n    flex: 1;\n    padding: 12px 16px;\n    overflow-y: auto;\n    overflow-x: hidden;\n    background-color: var(--bg-color);\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    scroll-behavior: smooth;\n    border-top-left-radius: 16px;\n    border-top-right-radius: 12px;\n  }\n\n  .messages-container::-webkit-scrollbar {\n    width: 6px;\n  }\n\n  .messages-container::-webkit-scrollbar-thumb {\n    background-color: rgba(0, 0, 0, 0.2);\n    border-radius: 3px;\n  }\n\n  .messages-container::-webkit-scrollbar-track {\n    background-color: transparent;\n  }\n\n  .chat-footer {\n  padding: 12px 16px; /* تقليل padding العلوي والسفلي قليلاً */\n  background-color: var(--footer-bg);\n  border-top: 1px solid var(--border-color);\n  }\n    .input-area {\n  margin-bottom: 8px; /* إضافة مسافة بين حقل الإدخال والنص السفلي */\n}\n\n\n  .chat-input-wrapper {\n  flex: 1;\n  display: flex; /* <<< تعديل: استخدام flex لتوزيع العناصر الداخلية */\n  align-items: center; /* <<< تعديل: محاذاة العناصر عموديًا في المنتصف */\n  position: relative;\n  background-color: var(--bg-color); /* أو #F0F0F0 لخلفية رمادية فاتحة */\n  border: 2px solid var(--border-color);\n  border-radius: 15px;\n  padding: 4px 8px 4px 16px; /* <<< تعديل: ضبط الحشو الداخلي */\n  gap: 8px; /* مسافة بين العناصر الداخلية */\n}\n\n\n.chat-input {\n    width: 100%;\n    min-height: 11px;\n    max-height: 150px;\n    border: none;\n    outline: none;\n    background: transparent;\n    color: var(--text-color);\n    font-size: 14px;\n    line-height: 1.4;\n    resize: none;\n    overflow-y: hidden;\n  }\n\n  .chat-input::placeholder {\n    color: var(--text-secondary);\n  }\n\n  .chat-input::-webkit-scrollbar {\n    width: 4px;\n  }\n\n  .chat-input::-webkit-scrollbar-thumb {\n    background-color: var(--border-color);\n    border-radius: 4px;\n  }\n\n\n/* --- نمط جديد لزر الميكروفون --- */\n.mic-button {\n  width: 32px; /* حجم مناسب */\n  height: 32px;\n  border-radius: 50%;\n  background: none; /* بدون خلفية */\n  color: var(--text-secondary); /* لون الأيقونة */\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: color 0.2s;\n  flex-shrink: 0;\n  padding: 0;\n}\n\n.mic-button:hover {\n  color: var(--text-color); /* تغيير اللون عند المرور */\n}\n\n.mic-button svg {\n    width: 18px; /* حجم الأيقونة */\n    height: 18px;\n}\n\n\n.send-button {\n  width: 36px; /* <<< تعديل: حجم الزر الدائري */\n  height: 36px;\n  border-radius: 50%;\n  /* <<< تعديل: تغيير لون الخلفية ليتناسب مع التصميم الجديد */\n  background-color: #E0E0E0; /* لون رمادي فاتح كالمثال */\n  /* أو يمكن استخدام متغير CSS إذا كان لديك واحد مناسب */\n  /* background-color: var(--border-color); */\n  color: var(--text-secondary); /* <<< تعديل: لون الأيقونة الافتراضي */\n  border: none;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  transition: background-color 0.2s, color 0.2s, transform 0.2s;\n  flex-shrink: 0;\n}\n\n.send-button:not(:disabled) { /* نمط زر الإرسال عندما يكون فعالاً */\n    background-color: var(--primary-color); /* <<< تعديل: العودة للون الأساسي عند التفعيل */\n    color: white; /* <<< تعديل: لون الأيقونة عند التفعيل */\n}\n\n.send-button:not(:disabled):hover {\n  background-color: var(--primary-hover); /* <<< تعديل: لون عند المرور وهو فعال */\n}\n\n.send-button:disabled {\n  background-color: #E9ECEF; /* لون رمادي فاتح جداً عند التعطيل */\n  color: #ADB5BD; /* لون أيقونة باهت */\n  opacity: 1; /* لا نحتاج لـ opacity هنا لأننا نغير الألوان */\n  cursor: not-allowed;\n}\n\n.send-button svg {\n  width: 18px;\n  height: 18px;\n}\n\n/* تمت إعادة تسمية الكلاس وتعديل النمط */\n.footer-powered-by {\n  text-align: center; /* <<< تعديل: توسيط النص */\n  margin-top: 8px; /* مسافة أعلى النص */\n  width: 100%; /* يأخذ العرض كامل للتوسيط */\n}\n\n/* تعديل نمط النص إذا لزم الأمر */\n.powered-by {\n  font-size: 12px;\n  color: var(--text-secondary);\n}\n\n  .typing-bubble {\n    background: transparent;\n    padding: 0;\n  }\n\n  .dot {\n    width: 8px;\n    height: 8px;\n    background: var(--text-secondary);\n    border-radius: 50%;\n    animation: bounce 1.2s infinite;\n  }\n\n  @keyframes bounce {\n    0%, 80%, 100% { transform: translateY(0); }\n    40% { transform: translateY(-6px); }\n  }\n\n  /* Mobile responsive styles */\n  @media (max-width: 576px) {\n    .chat-container {\n      width: 100vw !important;\n      max-width: 100vw !important;\n      height: 100vh !important;\n      right: 0 !important;\n      left: 0 !important;\n      bottom: 0 !important;\n      border-radius: 0;\n      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);\n    }\n\n    .chat-header, .chat-footer {\n      border-radius: 0;\n    }\n\n    :host([position="bottom-right"]) .chat-container,\n    :host([position="bottom-left"]) .chat-container {\n      bottom: 0;\n      right: 0;\n    }\n\n    .header-title {\n      font-size: 16px;\n    }\n\n    .header-subtitle {\n      font-size: 12px;\n    }\n  }\n';const t=document.createElement("template");t.innerHTML=`\n    <div class="chat-container">\n      <div class="chat-header">\n         <div class="top-bar">\n           <chat-avatar\n             size="24px"\n             src="${this.getAttribute("avatar")||"https://alaghbry0.github.io/chat-widget/profile.png"}"\n             fallback="${(this.getAttribute("title")||"Bot").charAt(0)}"\n             bg-color="var(--primary-color)">\n           </chat-avatar>\n           <h4 class="top-bar-title">${this.getAttribute("title")||"Exaado Assistant"}</h4>\n           <div class="top-bar-actions">\n             <button class="top-bar-button refresh-btn">\n               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                 <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"/>\n               </svg>\n             </button>\n             <button class="top-bar-button close-btn">\n               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                 <path d="M18 6 6 18M6 6l12 12"/>\n               </svg>\n             </button>\n           </div>\n         </div>\n         </div>\n\n       <div class="messages-container" id="messages" aria-live="polite">\n         <div class="welcome-message">\n           <chat-avatar\n             class="welcome-avatar"\n             size="75px"\n             src="${this.getAttribute("avatar")||"https://alaghbry0.github.io/chat-widget/profile.png"}"\n             fallback="${(this.getAttribute("title")||"Bot").charAt(0)}"\n             bg-color="var(--primary-color)">\n           </chat-avatar>\n           <h3 class="welcome-title">${this.getAttribute("title")||"Exaado Assistant"}</h3>\n           <p class="welcome-subtitle">${this.getAttribute("subtitle")||"Our virtual agent is here to help you"}</p>\n         </div>\n         </div>\n      <div class="chat-footer">\n        <div class="input-area">\n          <div class="chat-input-wrapper">\n            <textarea class="chat-input" placeholder="Message..." rows="1"></textarea>\n            <button class="mic-button" aria-label="Voice input">\n              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>\n                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>\n                <line x1="12" y1="19" x2="12" y2="23"></line>\n                <line x1="8" y1="23" x2="16" y2="23"></line>\n              </svg>\n            </button>\n            <button class="send-button" disabled aria-label="Send message">\n              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <line x1="12" y1="19" x2="12" y2="5"></line>\n                <polyline points="5 12 12 5 19 12"></polyline>\n              </svg>\n            </button>\n          </div>\n        </div>\n        <div class="footer-powered-by">\n          <span class="powered-by">${this.getAttribute("powered-by")||"Powered by Exaado"}</span>\n        </div>\n      </div>\n      </div>\n\n    <chat-button></chat-button>\n  `,this.shadowRoot.innerHTML="",this.shadowRoot.appendChild(e),this.shadowRoot.appendChild(t.content.cloneNode(!0)),this.chatContainer=this.shadowRoot.querySelector(".chat-container"),this.messagesContainer=this.shadowRoot.querySelector("#messages"),this.chatInput=this.shadowRoot.querySelector(".chat-input"),this.sendButton=this.shadowRoot.querySelector(".send-button"),this.chatButton=this.shadowRoot.querySelector("chat-button"),this.micButton=this.shadowRoot.querySelector(".mic-button");const n=document.createElement("style");n.textContent="\n      /* === بداية تعديل الأنماط === */\n      .welcome-message {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n\n        /* --- التعديل هنا: تقليل التباعد العلوي --- */\n        padding: 80px 0 10px 0; /* مثال: 30px للأعلى، 20px للأسفل */\n        gap: 8px;\n        animation: fadeIn 0.5s ease;\n      }\n\n      .welcome-avatar {\n      margin-bottom: 10px;\n         /* لا توجد أنماط خاصة مطلوبة هنا الآن */\n      }\n\n      .welcome-title {\n        font-size: 20px;\n        font-weight: 600;\n        color: var(--text-color);\n        margin: 0;\n        text-align: center;\n      }\n\n      .welcome-subtitle {\n        font-size: 14px;\n        font-weight: 400;\n        color: var(--text-secondary);\n        margin: 0;\n        text-align: center;\n      }\n      /* === نهاية تعديل الأنماط === */\n\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n    ",this.shadowRoot.appendChild(n)}_setupComponentListeners(){console.log("🔗 Setting up component listeners (run once)..."),this.chatButton?this.chatButton._listenerAttached||(this.chatButton.addEventListener("click",(()=>{this.toggleChat()})),this.chatButton._listenerAttached=!0):console.error("Chat button not found for component listener setup."),document._chatWidgetKeyListenerAttached||(document.addEventListener("keydown",(e=>{"/"===e.key&&this.isOpen&&this.chatInput&&document.activeElement!==this.chatInput&&(e.preventDefault(),this.chatInput.focus()),"Escape"===e.key&&this.isOpen&&this.toggleChat()})),document._chatWidgetKeyListenerAttached=!0)}_handleScroll(e){const t=this.messagesContainer.scrollTop;t>this.lastScrollPosition&&t>50&&!this.headerCollapsed?(this.profileHeader.classList.add("hidden"),this.headerCollapsed=!0):t<this.lastScrollPosition&&t<50&&this.headerCollapsed&&(this.profileHeader.classList.remove("hidden"),this.headerCollapsed=!1),this.lastScrollPosition=t}_autoResizeTextarea(){this.chatInput.style.height="auto",this.chatInput.style.height=this.chatInput.scrollHeight+"px",this.chatInput.scrollHeight>150?this.chatInput.style.overflowY="auto":this.chatInput.style.overflowY="hidden"}_addMessage(e){const t=Date.now().toString(),n=new Date,s={id:t,content:e.content,sender:e.sender,timestamp:n};this.messages.push(s);const r=document.createElement("chat-message");if(r.setAttribute("sender",e.sender),r.setAttribute("message-id",t),r.setAttribute("data-md",e.content),"bot"===e.sender&&(r.setAttribute("avatar",this.getAttribute("avatar")||""),r.setAttribute("show-avatar","true")),this.messagesContainer.appendChild(r),this._scrollToBottom(),2===this.messages.length&&"user"===this.messages[1].sender){const e=this.shadowRoot.querySelector("chat-suggestions");e&&(e.style.display="none")}return s}_sendMessage(){const e=this.chatInput.value.trim();if(!e)return;this._addMessage({content:e,sender:"user"}),this.chatInput.value="",this.chatInput.style.height="auto",this.sendButton.disabled=!0,this._showTypingIndicator();const t=this.getAttribute("api-url"),n=this.getAttribute("project-id");console.log(`Sending message to ${t} with projectId: ${n}, sessionId: ${this.sessionId}`),this.chatService.sendMessage(t,{message:e,session_id:this.sessionId,project_id:n}).then((e=>{console.log("Stream connection established",e);let t="",n=null;e.onmessage=e=>{if("chunk"===e.type){let s;try{s=JSON.parse(e.data)}catch(t){return void console.error("Invalid JSON in chunk:",t,e.data)}s.content&&(n||(this._hideTypingIndicator(),n=this._createLiveMessageElement()),t+=s.content,n&&"function"==typeof n.updateContent?n.updateContent(t):n&&(console.warn("liveMessageElement.updateContent is not a function. Falling back to textContent."),n.textContent=t),this._scrollToBottom())}else if("end"===e.type)console.log("Stream ended."),n?this._hideTypingIndicator():t?(this._hideTypingIndicator(),this._addMessage({content:t,sender:"bot"})):this._hideTypingIndicator(),n=null,t="",this.sendButton.disabled=!1;else if("error"===e.type){let s="عذراً، حدث خطأ في الخادم.";try{s=JSON.parse(e.data).message||s}catch{s=e.data||s}console.error("Error message from stream:",s),this._handleStreamError(s,n),n=null,t="",this.sendButton.disabled=!1}else console.log(`Ignoring event type: ${e.type}`)},e.onerror=e=>{console.error("SSE Connection Error:",e),this._handleStreamError("عذراً، حدث خطأ في الاتصال بالبث المباشر.",n),n=null,t="",this.sendButton.disabled=!1},e.onclose=()=>{console.log("SSE Stream closed"),n&&(console.warn("Stream closed unexpectedly before 'end'. Finalizing message."),n.remove(),this._addMessage({content:t,sender:"bot"})),this._hideTypingIndicator(),n=null,this.sendButton.disabled=!1}})).catch((e=>{console.error("Failed to initiate stream connection:",e),this._hideTypingIndicator(),this._addMessage({content:"عذراً، تعذر الاتصال بالخادم. يرجى التحقق من اتصالك والمحاولة مرة أخرى.",sender:"bot",isError:!0}),this.sendButton.disabled=!1}))}_createLiveMessageElement(){this.isTyping=!0;const e=document.createElement("chat-message");return e.setAttribute("sender","bot"),e.setAttribute("id","live-message"),e.setAttribute("data-md",""),this.getAttribute("avatar")&&e.setAttribute("avatar",this.getAttribute("avatar")),this.messagesContainer.appendChild(e),this._scrollToBottom(),e}_handleStreamError(e,t){this._hideTypingIndicator(),t&&t.remove(),this._addMessage({content:e,sender:"bot",isError:!0}),this.sendButton.disabled=!1}_showTypingIndicator(){this.isTyping=!0;const e=document.createElement("typing-indicator");e.setAttribute("avatar",this.getAttribute("avatar")||""),e.id="typing-indicator",this.messagesContainer.appendChild(e),this._scrollToBottom()}_hideTypingIndicator(){this.isTyping=!1;const e=this.shadowRoot.querySelector("#typing-indicator");e&&e.remove()}_clearChat(){for(this.messages=[];this.messagesContainer.firstChild;)this.messagesContainer.removeChild(this.messagesContainer.firstChild);this.sessionId=this._generateSessionId(),setTimeout((()=>{this._addMessage({content:this.getAttribute("welcome-message")||"مرحبًا بك! كيف يمكنني مساعدتك اليوم؟",sender:"bot"});const e=document.createElement("chat-suggestions");e.suggestions=["ما هي خدماتكم؟","كيف يمكنني التواصل مع الدعم؟","كيف يمكنني الاشتراك في كورس الزمني؟"],this.messagesContainer.appendChild(e)}),300)}_setupInitialChatState(){setTimeout((()=>{if(!this.messagesContainer)return void console.error("Messages container not found after reset.");const e=this.messagesContainer.querySelector('chat-message[sender="bot"]'),t=this.messagesContainer.querySelector("chat-suggestions");e&&0===this.messages.length&&e.remove(),t&&t.remove(),this._addMessage({content:this.getAttribute("welcome-message")||"مرحبًا بك! كيف يمكنني مساعدتك اليوم؟",sender:"bot"});const n=document.createElement("chat-suggestions");n.suggestions=["ما هي خدماتكم؟","كيف يمكنني التواصل مع الدعم؟","كيف يمكنني الاشتراك في كورس الزمني؟"],this.messagesContainer.appendChild(n),this.suggestionsElement=n,this._scrollToBottom()}),300)}toggleChat(){console.log("🔘 toggleChat fired! isOpen=",this.isOpen),this.isOpen=!this.isOpen,this.isOpen?(this.chatContainer.classList.add("open"),localStorage.setItem("chatWidgetOpen","true")):(this.chatContainer.classList.remove("open"),localStorage.setItem("chatWidgetOpen","false"))}_scrollToBottom(){setTimeout((()=>{this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}),100)}_generateSessionId(e=!1){const t=localStorage.getItem("chatWidgetSessionId");if(t&&!e)return t;const n="session_"+Math.random().toString(36).substring(2,15);return localStorage.setItem("chatWidgetSessionId",n),console.log("Generated new session ID:",n),n}connectedCallback(){"true"===localStorage.getItem("chatWidgetOpen")&&setTimeout((()=>this.toggleChat()),300)}_setupInternalListeners(){if(console.log("🔗 Setting up internal listeners..."),!(this.sendButton&&this.chatInput&&this.messagesContainer&&this.shadowRoot))return void console.error("One or more internal elements not found for listener setup.");this.sendButton.addEventListener("click",(()=>{this._sendMessage()})),this.chatInput.addEventListener("keydown",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this._sendMessage())})),this.chatInput.addEventListener("input",(()=>{this._autoResizeTextarea(),this.sendButton&&(this.sendButton.disabled=!this.chatInput.value.trim())}));this.shadowRoot.querySelectorAll(".close-btn").forEach((e=>{e.addEventListener("click",(()=>{this.toggleChat()}))}));const e=this.shadowRoot.querySelector(".refresh-btn");e?e.addEventListener("click",(()=>{this._resetChat()})):console.warn("Refresh button (.refresh-btn) not found during internal listener setup."),this.shadowRoot.addEventListener("suggestion-clicked",(e=>{if(this.chatInput){const{suggestion:t}=e.detail;this.chatInput.value=t,this._autoResizeTextarea(),this.sendButton.disabled=!1,this._sendMessage()}})),this.messagesContainer.addEventListener("scroll",this._handleScroll.bind(this)),this.sendButton&&(this.sendButton.disabled=!0),this.chatInput&&(this.chatInput.style.height="auto")}attributeChangedCallback(e,t,n){if(t!==n&&"direction"===e)this.style.direction=n||"rtl"}}customElements.define("chat-widget",Tt),window.ChatWidget={init:(e={})=>{const t={projectId:"",theme:"light",position:"bottom-right",welcomeMessage:"مرحبًا بك! كيف يمكنني مساعدتك اليوم؟",apiUrl:"https://exadoo-rxr9.onrender.com/bot/chat/stream",direction:"rtl",avatar:"",title:"Exaado Assistant",subtitle:"Our virtual agent is here to help you",poweredBy:"Powered by EXAADO:exaado.com",...e},n=document.createElement("chat-widget");return Object.entries(t).forEach((([e,t])=>{if(null==t||""===t)return;const s=e.replace(/([A-Z])/g,"-$1").toLowerCase();n.setAttribute(s,t)})),document.body.appendChild(n),n}},window.ChatWidgetOptions&&window.ChatWidget.init(window.ChatWidgetOptions)}();
